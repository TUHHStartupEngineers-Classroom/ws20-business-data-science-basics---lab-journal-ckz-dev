<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="David Hackenberger" />


<title>Journal Challenge 2a</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MyLabJournal</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Journal
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="challenge_1.html">Challenge 1 - tidyverse</a>
    </li>
    <li>
      <a href="challenge_2.html">Challenge 2 - Data Acquisition</a>
    </li>
    <li>
      <a href="challenge_3.html">Challenge 3 - Data Wrangling</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="dictionary.html">Dictionary</a>
    </li>
    <li>
      <a href="default_journal_notes.html">Default journal notes</a>
    </li>
    <li>
      <a href="data_wrangling.html">Data Wrangling</a>
    </li>
    <li>
      <a href="ggplot_graphs.html">ggplot graphs</a>
    </li>
    <li>
      <a href="machine_learning.html">machine learning</a>
    </li>
    <li>
      <a href="sales_analysis.html">Introduction to tidyverse</a>
    </li>
  </ul>
</li>
<li>
  <a href="links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Journal Challenge 2a</h1>
<h4 class="author">David Hackenberger</h4>
<h4 class="date">2020-11-026</h4>

</div>


<div id="challange-data-aquisition" class="section level1">
<h1>Challange Data Aquisition</h1>
</div>
<div id="challange-part-1" class="section level1">
<h1>1. Challange Part 1</h1>
<p>We want to compile an overview of drinks based on the liquor gin. For this we use the online database thecocktaildb and the provided API.</p>
<div id="install-libraries" class="section level4">
<h4>Install libraries</h4>
<pre class="r"><code>library(RSQLite)
library(tidyverse)
library(glue)
library(jsonlite)
library(httr)
library(xopen)  
library(data.table)</code></pre>
</div>
<div id="website-used" class="section level2">
<h2>Website used:</h2>
<p><a href="https://www.thecocktaildb.com" class="uri">https://www.thecocktaildb.com</a></p>
<pre class="r"><code>TheCocktailDB_home_url &lt;- &quot;https://www.thecocktaildb.com&quot;
xopen(TheCocktailDB_home_url)</code></pre>
<pre><code>## Running open &#39;https://www.thecocktaildb.com&#39;</code></pre>
</div>
<div id="retrieve-data-via-an-api" class="section level2">
<h2>Retrieve data via an API</h2>
<p>The API is free to use with an Academic License Key with limited functionality. Access is via the link: <a href="https://www.thecocktaildb.com/api/json/v1/" class="uri">https://www.thecocktaildb.com/api/json/v1/</a> followed by the license key, the desired database processing, a class and an element. Example: <a href="https://www.thecocktaildb.com/api/json/v1/1/search.php?s=margarita" class="uri">https://www.thecocktaildb.com/api/json/v1/1/search.php?s=margarita</a> searches a cocktail by name.</p>
<p>Since we can only retrieve limited lists from the database under the free license, we build a function that we execute multiple times and thus combine our own database.</p>
</div>
<div id="define-function" class="section level2">
<h2>Define function</h2>
<pre class="r"><code>                    #We will need the following variables:
                    #key    &lt;- 1        # Academic Token
                    #process  &lt;- &quot;filter&quot;   # list, filter, search, lookup
                    #operator  &lt;- &quot;i&quot;      # i: ingredients, i: idDrink, iid: ingrediants by ID
                    #element   &lt;- &quot;Gin&quot;   # &quot;list&quot; oder &quot;Benennung&quot;
thecocktaildb_JSON &lt;- function(key,process,operator,element){
  url &lt;- modify_url(url = TheCocktailDB_home_url, path = glue(&quot;/api/json/v1/{key}/{process}.php?{operator}={element}&quot;))
  resp &lt;- GET(url)
  stop_for_status(resp)
}</code></pre>
</div>
<div id="building-the-dataset" class="section level2">
<h2>Building the dataset</h2>
<p>First we get a list of contents to check how the spirit Gin is listed in the database.</p>
<pre class="r"><code>list_of_ingrediants_tbl &lt;- thecocktaildb_JSON(1,&quot;list&quot;,&quot;i&quot;,&quot;list&quot;) %&gt;%
# Convert
  .$content %&gt;% 
  rawToChar() %&gt;% 
  fromJSON()%&gt;%
  .$drinks %&gt;%
  as_tibble() %&gt;%
  # Renaming
  rename(&quot;Ingrediants&quot;       = &quot;strIngredient1&quot;)
  
list_of_ingrediants_tbl$Ingrediants</code></pre>
<pre><code>##   [1] &quot;Light rum&quot;            &quot;Applejack&quot;            &quot;Gin&quot;                 
##   [4] &quot;Dark rum&quot;             &quot;Sweet Vermouth&quot;       &quot;Strawberry schnapps&quot; 
##   [7] &quot;Scotch&quot;               &quot;Apricot brandy&quot;       &quot;Triple sec&quot;          
##  [10] &quot;Southern Comfort&quot;     &quot;Orange bitters&quot;       &quot;Brandy&quot;              
##  [13] &quot;Lemon vodka&quot;          &quot;Blended whiskey&quot;      &quot;Dry Vermouth&quot;        
##  [16] &quot;Amaretto&quot;             &quot;Tea&quot;                  &quot;Champagne&quot;           
##  [19] &quot;Coffee liqueur&quot;       &quot;Bourbon&quot;              &quot;Tequila&quot;             
##  [22] &quot;Vodka&quot;                &quot;Añejo rum&quot;            &quot;Bitters&quot;             
##  [25] &quot;Sugar&quot;                &quot;Kahlua&quot;               &quot;demerara Sugar&quot;      
##  [28] &quot;Dubonnet Rouge&quot;       &quot;Watermelon&quot;           &quot;Lime juice&quot;          
##  [31] &quot;Irish whiskey&quot;        &quot;Apple brandy&quot;         &quot;Carbonated water&quot;    
##  [34] &quot;Cherry brandy&quot;        &quot;Creme de Cacao&quot;       &quot;Grenadine&quot;           
##  [37] &quot;Port&quot;                 &quot;Coffee brandy&quot;        &quot;Red wine&quot;            
##  [40] &quot;Rum&quot;                  &quot;Grapefruit juice&quot;     &quot;Ricard&quot;              
##  [43] &quot;Sherry&quot;               &quot;Cognac&quot;               &quot;Sloe gin&quot;            
##  [46] &quot;Apple juice&quot;          &quot;Pineapple juice&quot;      &quot;Lemon juice&quot;         
##  [49] &quot;Sugar syrup&quot;          &quot;Milk&quot;                 &quot;Strawberries&quot;        
##  [52] &quot;Chocolate syrup&quot;      &quot;Yoghurt&quot;              &quot;Mango&quot;               
##  [55] &quot;Ginger&quot;               &quot;Lime&quot;                 &quot;Cantaloupe&quot;          
##  [58] &quot;Berries&quot;              &quot;Grapes&quot;               &quot;Kiwi&quot;                
##  [61] &quot;Tomato juice&quot;         &quot;Cocoa powder&quot;         &quot;Chocolate&quot;           
##  [64] &quot;Heavy cream&quot;          &quot;Galliano&quot;             &quot;Peach Vodka&quot;         
##  [67] &quot;Ouzo&quot;                 &quot;Coffee&quot;               &quot;Spiced rum&quot;          
##  [70] &quot;Water&quot;                &quot;Espresso&quot;             &quot;Angelica root&quot;       
##  [73] &quot;Orange&quot;               &quot;Cranberries&quot;          &quot;Johnnie Walker&quot;      
##  [76] &quot;Apple cider&quot;          &quot;Everclear&quot;            &quot;Cranberry juice&quot;     
##  [79] &quot;Egg yolk&quot;             &quot;Egg&quot;                  &quot;Grape juice&quot;         
##  [82] &quot;Peach nectar&quot;         &quot;Lemon&quot;                &quot;Firewater&quot;           
##  [85] &quot;Lemonade&quot;             &quot;Lager&quot;                &quot;Whiskey&quot;             
##  [88] &quot;Absolut Citron&quot;       &quot;Pisco&quot;                &quot;Irish cream&quot;         
##  [91] &quot;Ale&quot;                  &quot;Chocolate liqueur&quot;    &quot;Midori melon liqueur&quot;
##  [94] &quot;Sambuca&quot;              &quot;Cider&quot;                &quot;Sprite&quot;              
##  [97] &quot;7-Up&quot;                 &quot;Blackberry brandy&quot;    &quot;Peppermint schnapps&quot; 
## [100] &quot;Creme de Cassis&quot;</code></pre>
<p>Gin is the third entry in the contents list and is spelled “Gin”. Now let’s call up a list of all drinks with the ingredient Gin.</p>
<pre class="r"><code>list_of_Gin_drinks_tbl &lt;- thecocktaildb_JSON(1,&quot;filter&quot;,&quot;i&quot;,list_of_ingrediants_tbl$Ingrediants[3]) %&gt;%
# Convert
  .$content %&gt;% 
  rawToChar() %&gt;% 
  fromJSON() %&gt;%
  .$drinks %&gt;%
  as_tibble() %&gt;%
  #Clean
  select(-strDrinkThumb) %&gt;%
  # Renaming
  rename(&quot;Drink&quot;       = &quot;strDrink&quot;) %&gt;%
  rename(&quot;ID&quot;       = &quot;idDrink&quot;)</code></pre>
<p>Now we have the titles of the gin drinks and can use there ids to retrieve further information from the database.</p>
<pre class="r"><code>get_Details &lt;- function(id){
drink_details_tbl &lt;- thecocktaildb_JSON(1,&quot;lookup&quot;,&quot;i&quot;,id) %&gt;% 
  # Convert
  .$content %&gt;% 
  rawToChar() %&gt;% 
  fromJSON() %&gt;% 
  .$drinks %&gt;%
  as_tibble() %&gt;% 
  #Clean
  select(strDrink,idDrink,strCategory,strGlass,
         strInstructions,starts_with(&quot;strIngredient&quot;),starts_with(&quot;strMeasure&quot;))
}

library(furrr)     # Parallel Processing using furrr (iteration)
plan(&quot;multiprocess&quot;)</code></pre>
<pre><code>## Warning: Strategy &#39;multiprocess&#39; is deprecated in future (&gt;= 1.20.0). Instead,
## explicitly specify either &#39;multisession&#39; or &#39;multicore&#39;. In the current R
## session, &#39;multiprocess&#39; equals &#39;multisession&#39;.</code></pre>
<pre><code>## Warning in supportsMulticoreAndRStudio(...): [ONE-TIME WARNING] Forked
## processing (&#39;multicore&#39;) is not supported when running R from RStudio
## because it is considered unstable. For more details, how to control forked
## processing or not, and how to silence this warning in future R sessions, see ?
## parallelly::supportsMulticore</code></pre>
<pre class="r"><code>Gin_drinks_tbl &lt;- future_map(list_of_Gin_drinks_tbl$ID, get_Details) %&gt;% 
  rbindlist(use.names=TRUE, fill=FALSE, idcol=NULL) %&gt;% 
  as_tibble()

#Rename, beacuse most of the collums start with str
colnames(Gin_drinks_tbl) = gsub(&quot;str&quot;, &quot;&quot;, colnames(Gin_drinks_tbl))</code></pre>
</div>
<div id="resulting-dataset" class="section level2">
<h2>Resulting Dataset</h2>
<p>Now we have an extensive data set of gin drinks with ingredients, recipe and quantities.</p>
<pre class="r"><code>library(kableExtra)
options(knitr.table.format = &quot;html&quot;) 
kbl(Gin_drinks_tbl[1:10, ]) %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;),fixed_thead = T) %&gt;%
  column_spec(5, width = &quot;30em&quot;) %&gt;% 
  scroll_box(width = &quot;100%&quot;, height = &quot;400px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Drink
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
idDrink
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Category
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Glass
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Inuctions
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient2
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient3
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient4
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient5
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient6
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient7
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient8
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient9
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient10
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient11
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient12
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient13
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient14
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ingredient15
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure1
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure2
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure3
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure4
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure5
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure6
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure7
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure8
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure9
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure10
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure11
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure12
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure13
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure14
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Measure15
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
3-Mile Long Island Iced Tea
</td>
<td style="text-align:left;">
15300
</td>
<td style="text-align:left;">
Ordinary Drink
</td>
<td style="text-align:left;">
Collins Glass
</td>
<td style="text-align:left;width: 30em; ">
Fill 14oz glass with ice and alcohol. Fill 2/3 glass with cola and remainder with sweet &amp; sour. Top with dash of bitters and lemon wedge.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Light rum
</td>
<td style="text-align:left;">
Tequila
</td>
<td style="text-align:left;">
Triple sec
</td>
<td style="text-align:left;">
Vodka
</td>
<td style="text-align:left;">
Coca-Cola
</td>
<td style="text-align:left;">
Sweet and sour
</td>
<td style="text-align:left;">
Bitters
</td>
<td style="text-align:left;">
Lemon
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1-2 dash
</td>
<td style="text-align:left;">
1 wedge
</td>
<td style="text-align:left;">
Garnish with
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
69 Special
</td>
<td style="text-align:left;">
13940
</td>
<td style="text-align:left;">
Ordinary Drink
</td>
<td style="text-align:left;">
Collins Glass
</td>
<td style="text-align:left;width: 30em; ">
Pour 2 oz. gin. Add 4 oz. 7-up. Add Lemon Juice for flavor. If you are weak, top up glass with more 7-Up.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
7-Up
</td>
<td style="text-align:left;">
Lemon juice
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2 oz dry
</td>
<td style="text-align:left;">
4 oz
</td>
<td style="text-align:left;">
0.75 oz
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
A1
</td>
<td style="text-align:left;">
17222
</td>
<td style="text-align:left;">
Cocktail
</td>
<td style="text-align:left;">
Cocktail glass
</td>
<td style="text-align:left;width: 30em; ">
Pour all ingredients into a cocktail shaker, mix and serve over ice into a chilled glass.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Grand Marnier
</td>
<td style="text-align:left;">
Lemon Juice
</td>
<td style="text-align:left;">
Grenadine
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1 3/4 shot
</td>
<td style="text-align:left;">
1 Shot
</td>
<td style="text-align:left;">
1/4 Shot
</td>
<td style="text-align:left;">
1/8 Shot
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Abbey Cocktail
</td>
<td style="text-align:left;">
17834
</td>
<td style="text-align:left;">
Ordinary Drink
</td>
<td style="text-align:left;">
Cocktail glass
</td>
<td style="text-align:left;width: 30em; ">
Shake all ingredients (except for the cherry) with ice and strain into a cocktail glass. Top with the cherry and serve.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Orange bitters
</td>
<td style="text-align:left;">
Orange
</td>
<td style="text-align:left;">
Cherry
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1 1/2 oz
</td>
<td style="text-align:left;">
1 dash
</td>
<td style="text-align:left;">
Juice of 1/4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Abbey Martini
</td>
<td style="text-align:left;">
17223
</td>
<td style="text-align:left;">
Cocktail
</td>
<td style="text-align:left;">
Cocktail glass
</td>
<td style="text-align:left;width: 30em; ">
Put all ingredients into a shaker and mix, then strain contents into a chilled cocktail glass.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Sweet Vermouth
</td>
<td style="text-align:left;">
Orange Juice
</td>
<td style="text-align:left;">
Angostura Bitters
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2 shots
</td>
<td style="text-align:left;">
1 shot
</td>
<td style="text-align:left;">
1 shot
</td>
<td style="text-align:left;">
3 dashes
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Ace
</td>
<td style="text-align:left;">
17225
</td>
<td style="text-align:left;">
Cocktail
</td>
<td style="text-align:left;">
Martini Glass
</td>
<td style="text-align:left;width: 30em; ">
Shake all the ingredients in a cocktail shaker and ice then strain in a cold glass.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Grenadine
</td>
<td style="text-align:left;">
Heavy cream
</td>
<td style="text-align:left;">
Milk
</td>
<td style="text-align:left;">
Egg White
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2 shots
</td>
<td style="text-align:left;">
1/2 shot
</td>
<td style="text-align:left;">
1/2 shot
</td>
<td style="text-align:left;">
1/2 shot
</td>
<td style="text-align:left;">
1/2 Fresh
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Adam &amp; Eve
</td>
<td style="text-align:left;">
17226
</td>
<td style="text-align:left;">
Cocktail
</td>
<td style="text-align:left;">
Cocktail glass
</td>
<td style="text-align:left;width: 30em; ">
Shake together all the ingredients and strain into a cold glass.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Cognac
</td>
<td style="text-align:left;">
Creme de Cassis
</td>
<td style="text-align:left;">
Fresh Lemon Juice
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1 shot
</td>
<td style="text-align:left;">
1 shot
</td>
<td style="text-align:left;">
1 shot
</td>
<td style="text-align:left;">
1/8 shot
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Addison
</td>
<td style="text-align:left;">
17228
</td>
<td style="text-align:left;">
Cocktail
</td>
<td style="text-align:left;">
Martini Glass
</td>
<td style="text-align:left;width: 30em; ">
Shake together all the ingredients and strain into a cold glass.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Vermouth
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1 1/2 shot
</td>
<td style="text-align:left;">
1 1/2 shot
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Alaska Cocktail
</td>
<td style="text-align:left;">
11013
</td>
<td style="text-align:left;">
Ordinary Drink
</td>
<td style="text-align:left;">
Cocktail glass
</td>
<td style="text-align:left;width: 30em; ">
Stir all ingredients with ice, strain contents into a cocktail glass. Drop in a twist of lemon and serve.
</td>
<td style="text-align:left;">
Orange bitters
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Yellow Chartreuse
</td>
<td style="text-align:left;">
Lemon peel
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2 dashes
</td>
<td style="text-align:left;">
1 1/2 oz
</td>
<td style="text-align:left;">
3/4 oz
</td>
<td style="text-align:left;">
Twist of
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Alexander
</td>
<td style="text-align:left;">
11014
</td>
<td style="text-align:left;">
Ordinary Drink
</td>
<td style="text-align:left;">
Cocktail glass
</td>
<td style="text-align:left;width: 30em; ">
Shake all ingredients with ice and strain contents into a cocktail glass. Sprinkle nutmeg on top and serve.
</td>
<td style="text-align:left;">
Gin
</td>
<td style="text-align:left;">
Creme de Cacao
</td>
<td style="text-align:left;">
Light cream
</td>
<td style="text-align:left;">
Nutmeg
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1/2 oz
</td>
<td style="text-align:left;">
1/2 oz white
</td>
<td style="text-align:left;">
2 oz
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="writing-files" class="section level2">
<h2>Writing Files</h2>
<div id="rds" class="section level3">
<h3>RDS</h3>
<pre class="r"><code>Gin_drinks_tbl %&gt;% 
  write_rds(&quot;~/Documents/GitHub/ws20-business-data-science-basics---lab-journal-ckz-dev/Manipulated_Data/Data_aquisition/Gin_drinks.rds&quot;)</code></pre>
</div>
</div>
</div>
<div id="challange-part-2" class="section level1">
<h1>2. Challange Part 2</h1>
<div id="question" class="section level2">
<h2>Question</h2>
<p>We want to build a dataset buy web scapping from the Rosebike webshop. The scope is a database with the model names and prices, not just for one category but for all products. #### New libraries</p>
<pre class="r"><code>library(rvest)
library(stringi)   # character string/text processing</code></pre>
<p>We can use the selector Gadget to get more information about the website structure. #### get css /x path selector Gadget, run in searchbar</p>
<pre class="r"><code>javascript:(function()%7Bvar%20s=document.createElement(&#39;div&#39;);s.innerHTML=
              &#39;Loading...&#39;;s.style.color=&#39;black&#39;;s.style.padding=&#39;20px&#39;;s.style.position=
              &#39;fixed&#39;;s.style.zIndex=&#39;9999&#39;;s.style.fontSize=&#39;3.0em&#39;;s.style.border=
              &#39;2px%20solid%20black&#39;;s.style.right=&#39;40px&#39;;s.style.top=&#39;40px&#39;;s.setAttribute
            (&#39;class&#39;,&#39;selector_gadget_loading&#39;);s.style.background=&#39;white&#39;;document.body.appendChild(s);s=
              document.createElement(&#39;script&#39;);s.setAttribute(&#39;type&#39;,&#39;text/javascript&#39;);s.setAttribute
            (&#39;src&#39;,&#39;https://dv0akt2986vzh.cloudfront.net/unstable/lib/selectorgadget.js&#39;);document.body.appendChild(s);%7D)();</code></pre>
</div>
<div id="get-urls-for-product-categories" class="section level2">
<h2>Get URLs for product categories</h2>
<p>The categories can be scapped from the navigation bar at the top right and acessed via the titles.</p>
<pre class="r"><code>url_home          &lt;- &quot;https://www.rosebikes.de&quot;
#xopen(url_home) # Open links directly from RStudio to inspect them

# Read in the HTML for the entire webpage
html_home         &lt;- read_html(url_home)

# Web scrape the categroies
bike_category_url_tbl &lt;- html_home %&gt;%

  # Get the nodes for the families with the title description. The pointer is unique for bicycle categories.
  html_nodes(css = &quot;.main-navigation-category-with-tiles__item &gt; a&quot;) %&gt;% 
  # ...and extract the information of the href
  html_attr(&quot;href&quot;) %&gt;% 

  # Remove the product categorie sale because these bikes are parrt of other categoreis as well
  discard(.p = ~stringr::str_detect(.x,&quot;sale&quot;)) %&gt;% 

  # Convert vector to tibble
  enframe(name = &quot;position&quot;, value = &quot;subdirectory&quot;) %&gt;% 
  as_tibble() %&gt;% 
  
  # Create a additinal collumn to store the url to each sub-page
  mutate(url = glue(&quot;{url_home}{subdirectory}&quot;))</code></pre>
</div>
<div id="get-urls-for-product-families" class="section level2">
<h2>Get URLs for product families</h2>
<p>Now we have a tbl with the url links to each product category. From there we can get the product families which contain the bike models. For that we set up a function that gets the families the same way as we got the categories for each category.</p>
<pre class="r"><code>#Function to get the subdirectories for the bike families
get_bike_family_subd &lt;- function(url) {
  html_bike_family &lt;- read_html(url)
  bike_category_family_tbl &lt;-  html_bike_family %&gt;% 
  html_nodes(css = &quot;.catalog-category-bikes__list-item &gt; div &gt; a&quot;) %&gt;% 
  html_attr(&quot;href&quot;) %&gt;% 
  # Convert vector to tibble
  enframe(name = &quot;position_cf&quot;, value = &quot;subdirectory_cf&quot;) %&gt;% 
  as_tibble()
               
}

#Mapping the function with every bike category
bike_family_url_tbl &lt;- map(bike_category_url_tbl$url,get_bike_family_subd) %&gt;%
  # Unpack the mapped list and convert it to a tibble
  rbindlist(use.names=TRUE, fill=FALSE, idcol=NULL) %&gt;% 
  as_tibble() %&gt;% 
  # create a extra collumn to store the link to each product family page
  mutate(url = glue(&quot;{url_home}{subdirectory_cf}&quot;)) %&gt;% 
  # organize
  select(url,subdirectory_cf) %&gt;% 
  # convert glue to char
  mutate(url = as.character(url))</code></pre>
</div>
<div id="excess-product-data" class="section level2">
<h2>Excess product data</h2>
<p>Now its time to excesses each product family page and gather the information about the different product variations. Each bike may have more than one variation to buy it, which have a different name and price of course. For this, we set up a function that builds the dataset step by step from each url we collected before.</p>
<pre class="r"><code># function to gather information about the product variatinos
get_bike_info &lt;- function(url,subd) {
  # read each family page
  html_bike_model &lt;- read_html(url)
  # get the names of the different variants
  bike_info_names_tbl &lt;-  html_bike_model %&gt;% 
      # the info is stored in the box title again
      html_nodes(css = &quot;.catalog-category-model__title&quot;) %&gt;%
      # get the text
      html_text() %&gt;% 
      # get rid of unwanted characters
      str_remove(pattern = &quot;\n&quot;) %&gt;% 
      str_remove(pattern = &quot;\n&quot;) %&gt;% 
      # convert to list
      enframe(name = &quot;position&quot;, value = &quot;model&quot;) %&gt;% 
      # Convert vector to tibble
      as_tibble()
  
  # get the prices for each variant in the same way as we got the names
  bike_info_price_tbl &lt;- html_bike_model %&gt;% 
    html_nodes(css = &quot;.product-tile-price__current-value.catalog-category-model__price-current-value&quot;) %&gt;% 
    html_text() %&gt;% 
    str_remove(pattern = &quot;\n&quot;) %&gt;% 
    str_remove(pattern = &quot;\n&quot;) %&gt;%
    enframe(name = &quot;position&quot;, value = &quot;price&quot;) %&gt;% 
    # Convert vector to tibble
    as_tibble() %&gt;% 
    # Converts prices from strings to integers for later calculations
    #Convert € strg to numeric value
    mutate(price = gsub(&quot;\\.&quot;,&quot;&quot;,price),price = gsub(&quot;,00&quot;,&quot;&quot;,price),price = gsub(&quot;€&quot;,&quot;&quot;,price),price = as.numeric(price))
  
  # Creating a dataset putting together Category, Family, Model, price, url
  bike_model_collected_info_tbl &lt;- left_join(bike_info_names_tbl,bike_info_price_tbl,by = &quot;position&quot;) %&gt;% mutate(link = url, Category_Family = subd) %&gt;% 
    # to get the category and family we seperate the subdirectory wich is seperated by /
    separate(col = Category_Family, into = c(&quot;category_1&quot;,&quot;category_2&quot;,&quot;category&quot;,&quot;family&quot;),
        sep = &quot;/&quot;,extra = &quot;drop&quot;) %&gt;% 
    # get rid of unwanted cahacters
    mutate(family = gsub(&quot;\\-&quot;, &quot;&quot;,family))
  
  # asaamble the dataset
  bike_model_info_tbl &lt;-   bike_model_collected_info_tbl %&gt;% 
    # Delet unessesarry columns 
    select(-position,-category_1,-category_2) %&gt;% 
    #Restructure
    select(category,family,model,price,link)
    
}</code></pre>
</div>
<div id="test-the-function" class="section level2">
<h2>Test the function</h2>
<p>Test for one</p>
<pre class="r"><code>bike_model_info_tbl_1 &lt;- get_bike_info(bike_family_url_tbl$url[1],bike_family_url_tbl$subdirectory_cf[1])</code></pre>
</div>
<div id="assamble-dataset" class="section level2">
<h2>Assamble dataset</h2>
<p>As this works we can use the function to get the information for every product.</p>
<pre class="r"><code>library(furrr)
plan(&quot;multiprocess&quot;)
# Future_map2 to map over several inputs
rose_bike_products_tbl &lt;- future_map2(bike_family_url_tbl$url,bike_family_url_tbl$subdirectory_cf,get_bike_info) %&gt;% 
  rbindlist(use.names=TRUE, fill=FALSE, idcol=NULL) %&gt;% 
  as_tibble()</code></pre>
</div>
<div id="resulting-data" class="section level2">
<h2>Resulting Data</h2>
<pre class="r"><code>options(knitr.table.format = &quot;html&quot;) 
kbl(rose_bike_products_tbl[1:10, ]) %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;),fixed_thead = T) %&gt;%
  column_spec(3, width = &quot;30em&quot;) %&gt;% 
  column_spec(5, width = &quot;50em&quot;) %&gt;% 
  scroll_box(width = &quot;100%&quot;, height = &quot;400px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
category
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
family
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
model
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
price
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
link
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
GROUND CONTROL 1
</td>
<td style="text-align:right;">
1699
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
GROUND CONTROL 2
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
GROUND CONTROL 3
</td>
<td style="text-align:right;">
2599
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
GROUND CONTROL 4
</td>
<td style="text-align:right;">
3299
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/ground-control</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
ROOT MILLER 1
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/root-miller" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/root-miller</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
ROOT MILLER 2
</td>
<td style="text-align:right;">
2599
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/root-miller" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/root-miller</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
ROOT MILLER 3
</td>
<td style="text-align:right;">
3399
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/root-miller" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/root-miller</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
PIKES PEAK 1
</td>
<td style="text-align:right;">
3099
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/pikes-peak" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/pikes-peak</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
PIKES PEAK 2
</td>
<td style="text-align:right;">
3599
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/pikes-peak" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/pikes-peak</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
mtb
</td>
<td style="text-align:left;">
trail
</td>
<td style="text-align:left;width: 30em; ">
PIKES PEAK 3
</td>
<td style="text-align:right;">
4299
</td>
<td style="text-align:left;width: 50em; ">
<a href="https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/pikes-peak" class="uri">https://www.rosebikes.de/fahrräder/mtb/trail-/-enduro/pikes-peak</a>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="writing-files-1" class="section level2">
<h2>Writing Files</h2>
<div id="rds-1" class="section level3">
<h3>RDS</h3>
<pre class="r"><code>rose_bike_products_tbl %&gt;% 
  write_rds(&quot;~/Documents/GitHub/ws20-business-data-science-basics---lab-journal-ckz-dev/Manipulated_Data/Data_aquisition/rose_bike_products.rds&quot;)</code></pre>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
